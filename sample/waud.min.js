/*!
 * waud.js - v0.3.4
 * Compiled on 21-01-2016 01:01:21
 * waud.js is licensed under the MIT License.
 * Copyright (c) 2015-2016 Adi Reddy Mora
*/
!function(a,b){"use strict";function c(a,b){function c(){}c.prototype=a;var d=new c;for(var e in b)d[e]=b[e];return b.toString!==Object.prototype.toString&&(d.toString=b.toString),d}function d(a,b){if(null==b)return null;null==b.__id__&&(b.__id__=y++);var c;return null==a.hx__closures__?a.hx__closures__={}:c=a.hx__closures__[b.__id__],null==c&&(c=function(){return c.method.apply(c.scope,arguments)},c.scope=a,c.method=b,a.hx__closures__[b.__id__]=c),c}var e=function(){this.bufferList=new v,this.playingSounds=new v,this.types=new v,this.types.set("mp3","audio/mpeg"),this.types.set("ogg","audio/ogg"),this.types.set("wav","audio/wav"),this.types.set("aac","audio/aac"),this.types.set("m4a","audio/x-m4a")};e.prototype={checkWebAudioAPISupport:function(){return null!=k.field(window,"AudioContext")?(e.AudioContextClass=k.field(window,"AudioContext"),!0):null!=k.field(window,"webkitAudioContext")?(e.AudioContextClass=k.field(window,"webkitAudioContext"),!0):!1},unlockAudio:function(){if(null!=this.audioContext){var a=this.audioContext.createBuffer(1,1,n.preferredSampleRate),b=this.audioContext.createBufferSource();b.buffer=a,b.connect(this.audioContext.destination),b.start(0),null!=b.onended?b.onended=d(this,this._unlockCallback):t.delay(d(this,this._unlockCallback),1)}},_unlockCallback:function(){null!=n.__touchUnlockCallback&&n.__touchUnlockCallback(),n.dom.ontouchend=null},createAudioContext:function(){if(null==this.audioContext)try{null!=e.AudioContextClass&&(this.audioContext=m.createInstance(e.AudioContextClass,[]))}catch(a){a instanceof w&&(a=a.val),this.audioContext=null}},destroy:function(){null!=this.audioContext&&null!=this.audioContext.close&&""!=this.audioContext.close&&this.audioContext.close(),this.audioContext=null,this.bufferList=null,this.playingSounds=null,this.types=null}};var f=function(a,b){null!=a&&""!=a&&null!=n.audioManager&&(this.isSpriteSound=!1,this.url=a,this._isLoaded=!1,this._isPlaying=!1,this._muted=!1,null==b&&(b={}),null!=b.autoplay?b.autoplay=b.autoplay:b.autoplay=n.defaults.autoplay,null!=b.webaudio?b.webaudio=b.webaudio:b.webaudio=n.defaults.webaudio,null!=b.preload?b.preload=b.preload:b.preload=n.defaults.preload,null!=b.loop?b.loop=b.loop:b.loop=n.defaults.loop,null!=b.volume&&b.volume>=0&&b.volume<=1?b.volume=b.volume:b.volume=n.defaults.volume,null!=b.onload?b.onload=b.onload:b.onload=n.defaults.onload,null!=b.onend?b.onend=b.onend:b.onend=n.defaults.onend,null!=b.onerror?b.onerror=b.onerror:b.onerror=n.defaults.onerror,this._options=b)},g=function(a,b){b=b.split("u").join(""),this.r=new RegExp(a,b)};g.prototype={match:function(a){return this.r.global&&(this.r.lastIndex=0),this.r.m=this.r.exec(a),this.r.s=a,null!=this.r.m},matched:function(a){if(null!=this.r.m&&a>=0&&a<this.r.m.length)return this.r.m[a];throw new w("EReg::matched")}};var h=function(){},i=function(a,b){f.call(this,a,b),this._snd=n.dom.createElement("audio"),this._addSource(a),this._options.preload&&this.load()};i.__interfaces__=[h],i.__super__=f,i.prototype=c(f.prototype,{load:function(a){var b=this;return this._isLoaded||(this._snd.autoplay=this._options.autoplay,this._snd.loop=this._options.loop,this._snd.volume=this._options.volume,null!=a&&(this._options.onload=a),this._options.preload?this._snd.preload="auto":this._snd.preload="metadata",null!=this._options.onload&&(this._isLoaded=!0,this._snd.onloadeddata=function(){b._options.onload(b)}),this._snd.onplaying=function(){b._isPlaying=!0},this._snd.onended=function(){b._isPlaying=!1,null!=b._options.onend&&b._options.onend(b)},null!=this._options.onerror&&(this._snd.onerror=function(){b._options.onerror(b)}),this._snd.load()),this},_addSource:function(a){if(this._src=n.dom.createElement("source"),this._src.src=a,null!=function(b){var c,d=b._getExt(a);return c=n.audioManager.types.get(d)}(this)){var b=this._getExt(a);this._src.type=n.audioManager.types.get(b)}return this._snd.appendChild(this._src),this._src},_getExt:function(a){return a.split(".").pop()},setVolume:function(a){this._isLoaded&&a>=0&&1>=a&&(this._snd.volume=a,this._options.volume=a)},getVolume:function(){return this._options.volume},mute:function(a){this._isLoaded&&(this._snd.muted=a,q.isiOS()&&(a&&this.isPlaying()?(this._muted=!0,this._snd.pause()):this._muted&&(this._muted=!1,this._snd.play())))},play:function(a,b){var c=this;return this._isLoaded?this._muted?this:(this.isSpriteSound&&null!=b&&(this._snd.currentTime=b.start,null!=this._tmr&&this._tmr.stop(),this._tmr=t.delay(function(){null!=b.loop&&b.loop?c.play(a,b):c.stop()},Math.ceil(1e3*b.duration))),this._snd.play(),this):this},isPlaying:function(){return this._isPlaying},loop:function(a){this._isLoaded&&(this._snd.loop=a)},stop:function(){this._isLoaded&&(this._snd.pause(),this._snd.currentTime=0)},onEnd:function(a){return this._options.onend=a,this},onLoad:function(a){return this._options.onload=a,this},destroy:function(){null!=this._snd&&(this._snd.pause(),this._snd.removeChild(this._src),this._src=null,this._snd=null)}});var j=function(){};j.cca=function(a,b){var c=a.charCodeAt(b);if(c==c)return c};var k=function(){};k.field=function(a,b){try{return a[b]}catch(c){return c instanceof w&&(c=c.val),null}};var l=function(){};l.parseInt=function(a){var b=parseInt(a,10);return 0!=b||120!=j.cca(a,1)&&88!=j.cca(a,1)||(b=parseInt(a)),isNaN(b)?null:b};var m=function(){};m.createInstance=function(a,b){var c=b.length;switch(c){case 0:return new a;case 1:return new a(b[0]);case 2:return new a(b[0],b[1]);case 3:return new a(b[0],b[1],b[2]);case 4:return new a(b[0],b[1],b[2],b[3]);case 5:return new a(b[0],b[1],b[2],b[3],b[4]);case 6:return new a(b[0],b[1],b[2],b[3],b[4],b[5]);case 7:return new a(b[0],b[1],b[2],b[3],b[4],b[5],b[6]);case 8:return new a(b[0],b[1],b[2],b[3],b[4],b[5],b[6],b[7]);default:throw new w("Too many arguments")}return null};var n=b.Waud=function(){};n.init=function(a){null==a&&(a=window.document),n.dom=a,n.__audioElement=n.dom.createElement("audio"),null==n.audioManager&&(n.audioManager=new e),n.isWebAudioSupported=n.audioManager.checkWebAudioAPISupport(),n.isHTML5AudioSupported=null!=k.field(window,"Audio"),n.audioContext=n.audioManager.audioContext,n.isWebAudioSupported?n.audioManager.createAudioContext():!n.isHTML5AudioSupported,n.sounds=new v},n.autoMute=function(){var a=function(){for(var a=n.sounds.iterator();a.hasNext();){var b=a.next();b.mute(!0)}},b=function(){if(!n.isMuted)for(var a=n.sounds.iterator();a.hasNext();){var b=a.next();b.mute(!1)}};n._focusManager=new o,n._focusManager.focus=b,n._focusManager.blur=a},n.enableTouchUnlock=function(a){n.__touchUnlockCallback=a,n.dom.ontouchend=(x=n.audioManager,d(x,x.unlockAudio))},n.mute=function(a){if(null==a&&(a=!0),n.isMuted=a,null!=n.sounds)for(var b=n.sounds.iterator();b.hasNext();){var c=b.next();c.mute(a)}},n.stop=function(){if(null!=n.sounds)for(var a=n.sounds.iterator();a.hasNext();){var b=a.next();b.stop()}},n.getFormatSupportString=function(){var a="OGG: "+n.__audioElement.canPlayType('audio/ogg; codecs="vorbis"');return a+=", WAV: "+n.__audioElement.canPlayType('audio/wav; codecs="1"'),a+=", MP3: "+n.__audioElement.canPlayType("audio/mpeg;"),a+=", AAC: "+n.__audioElement.canPlayType("audio/aac;"),a+=", M4A: "+n.__audioElement.canPlayType("audio/x-m4a;")},n.isSupported=function(){return(null==n.isWebAudioSupported||null==n.isHTML5AudioSupported)&&(n.isWebAudioSupported=n.audioManager.checkWebAudioAPISupport(),n.isHTML5AudioSupported=null!=k.field(window,"Audio")),n.isWebAudioSupported||n.isHTML5AudioSupported},n.isOGGSupported=function(){var a=n.__audioElement.canPlayType('audio/ogg; codecs="vorbis"');return n.isHTML5AudioSupported&&null!=a&&("probably"==a||"maybe"==a)},n.isWAVSupported=function(){var a=n.__audioElement.canPlayType('audio/wav; codecs="1"');return n.isHTML5AudioSupported&&null!=a&&("probably"==a||"maybe"==a)},n.isMP3Supported=function(){var a=n.__audioElement.canPlayType("audio/mpeg;");return n.isHTML5AudioSupported&&null!=a&&("probably"==a||"maybe"==a)},n.isAACSupported=function(){var a=n.__audioElement.canPlayType("audio/aac;");return n.isHTML5AudioSupported&&null!=a&&("probably"==a||"maybe"==a)},n.isM4ASupported=function(){var a=n.__audioElement.canPlayType("audio/x-m4a;");return n.isHTML5AudioSupported&&null!=a&&("probably"==a||"maybe"==a)},n.destroy=function(){if(null!=n.sounds)for(var a=n.sounds.iterator();a.hasNext();){var b=a.next();b.destroy()}n.sounds=null,null!=n.audioManager&&n.audioManager.destroy(),n.audioManager=null,n.audioContext=null,n.__audioElement=null,null!=n._focusManager&&(n._focusManager.clearEvents(),n._focusManager.blur=null,n._focusManager.focus=null)};var o=b.WaudFocusManager=function(){var a=this;this._hidden="",this._visibilityChange="",this._currentState="",null!=k.field(window.document,"hidden")?(this._hidden="hidden",this._visibilityChange="visibilitychange"):null!=k.field(window.document,"mozHidden")?(this._hidden="mozHidden",this._visibilityChange="mozvisibilitychange"):null!=k.field(window.document,"msHidden")?(this._hidden="msHidden",this._visibilityChange="msvisibilitychange"):null!=k.field(window.document,"webkitHidden")&&(this._hidden="webkitHidden",this._visibilityChange="webkitvisibilitychange"),null!=k.field(window,"addEventListener")?(window.addEventListener("focus",d(this,this._focus)),window.addEventListener("blur",d(this,this._blur)),window.addEventListener("pageshow",d(this,this._focus)),window.addEventListener("pagehide",d(this,this._blur)),document.addEventListener(this._visibilityChange,d(this,this._handleVisibilityChange))):null!=k.field(window,"attachEvent")?(window.attachEvent("onfocus",d(this,this._focus)),window.attachEvent("onblur",d(this,this._blur)),window.attachEvent("pageshow",d(this,this._focus)),window.attachEvent("pagehide",d(this,this._blur)),document.attachEvent(this._visibilityChange,d(this,this._handleVisibilityChange))):window.onload=function(){window.onfocus=d(a,a._focus),window.onblur=d(a,a._blur),window.onpageshow=d(a,a._focus),window.onpagehide=d(a,a._blur)}};o.prototype={_handleVisibilityChange:function(){null!=k.field(window.document,this._hidden)&&k.field(window.document,this._hidden)&&null!=this.blur?this.blur():null!=this.focus&&this.focus()},_focus:function(){"focus"!=this._currentState&&null!=this.focus&&this.focus(),this._currentState="focus"},_blur:function(){"blur"!=this._currentState&&null!=this.blur&&this.blur(),this._currentState="blur"},clearEvents:function(){null!=k.field(window,"removeEventListener")?(window.removeEventListener("focus",d(this,this._focus)),window.removeEventListener("blur",d(this,this._blur)),window.removeEventListener("pageshow",d(this,this._focus)),window.removeEventListener("pagehide",d(this,this._blur)),window.removeEventListener(this._visibilityChange,d(this,this._handleVisibilityChange))):null!=k.field(window,"removeEvent")?(window.removeEvent("onfocus",d(this,this._focus)),window.removeEvent("onblur",d(this,this._blur)),window.removeEvent("pageshow",d(this,this._focus)),window.removeEvent("pagehide",d(this,this._blur)),window.removeEvent(this._visibilityChange,d(this,this._handleVisibilityChange))):(window.onfocus=null,window.onblur=null,window.onpageshow=null,window.onpagehide=null)}};var p=b.WaudSound=function(a,b){null!=n.audioManager&&(this._options=b,a.indexOf(".json")>0?(this.isSpriteSound=!0,this._loadSpriteJson(a)):(this.isSpriteSound=!1,this._init(a)),n.sounds.set(a,this))};p.__interfaces__=[h],p.prototype={_loadSpriteJson:function(a){var b=this,c=new XMLHttpRequest;c.overrideMimeType("application/json"),c.open("GET",a,!0),c.onreadystatechange=function(){4==c.readyState&&200==c.status&&(b._spriteData=JSON.parse(c.response),b._init(b._spriteData.src))},c.send(null)},_init:function(a){this.url=a,n.isWebAudioSupported&&n.useWebAudio&&(null==this._options||null==this._options.webaudio||this._options.webaudio)?this._snd=new r(a,this._options):n.isHTML5AudioSupported&&(this._snd=new i(a,this._options)),this._snd.isSpriteSound=this.isSpriteSound},setVolume:function(a){null!=this._snd&&this._snd.setVolume(a)},getVolume:function(){return null==this._snd?0:this._snd.getVolume()},mute:function(a){null!=this._snd&&this._snd.mute(a)},load:function(a){return null==this._snd?null:(this._snd.load(a),this)},play:function(a,b){if(null==this._snd)return null;if(null!=a)for(var c=0,d=this._spriteData.sprite;c<d.length;){var e=d[c];if(++c,e.name==a){b=e;break}}return this._snd.play(a,b),this},isPlaying:function(){return null==this._snd?!1:this._snd.isPlaying()},loop:function(a){null!=this._snd&&this._snd.loop(a)},stop:function(){null!=this._snd&&this._snd.stop()},onEnd:function(a){return null==this._snd?null:(this._snd.onEnd(a),this)},onLoad:function(a){return null==this._snd?null:(this._snd.onLoad(a),this)},destroy:function(){null!=this._snd&&(this._snd.destroy(),this._snd=null)}};var q=b.WaudUtils=function(){};q.isAndroid=function(){return new g("Android","i").match(q.ua)},q.isiOS=function(){return new g("(iPad|iPhone|iPod)","i").match(q.ua)},q.isWindowsPhone=function(){return new g("(IEMobile|Windows Phone)","i").match(q.ua)},q.isFirefox=function(){return new g("Firefox","i").match(q.ua)},q.isOpera=function(){return new g("Opera","i").match(q.ua)||null!=k.field(window,"opera")},q.isChrome=function(){return new g("Chrome","i").match(q.ua)},q.isSafari=function(){return new g("Safari","i").match(q.ua)},q.isMobile=function(){return new g("(iPad|iPhone|iPod|Android|webOS|BlackBerry|Windows Phone|IEMobile)","i").match(q.ua)},q.getiOSVersion=function(){var a=new g("[0-9_]+?[0-9_]+?[0-9_]+","i"),b=[];if(a.match(q.ua)){for(var c=a.matched(0).split("_"),d=[],e=0;e<c.length;){var f=c[e];++e,d.push(l.parseInt(f))}b=d}return b};var r=function(a,b){f.call(this,a,b),this._manager=n.audioManager,this._options.preload&&this.load()};r.__interfaces__=[h],r.__super__=f,r.prototype=c(f.prototype,{_onSoundLoaded:function(a){this._manager.audioContext.decodeAudioData(a.target.response,d(this,this._decodeSuccess),d(this,this._error))},_decodeSuccess:function(a){return null==a?void(null!=this._options.onerror&&this._options.onerror(this)):(this._manager.bufferList.set(this.url,a),this._isLoaded=!0,null!=this._options.onload&&this._options.onload(this),void(this._options.autoplay&&this.play()))},_error:function(){null!=this._options.onerror&&this._options.onerror(this)},_makeSource:function(a){var b=this._manager.audioContext.createBufferSource();return this._gainNode=this._manager.audioContext.createGain(),this._gainNode.gain.value=this._options.volume,b.buffer=a,b.connect(this._gainNode),this._gainNode.connect(this._manager.audioContext.destination),b},load:function(a){if(!this._isLoaded){var b=new XMLHttpRequest;b.open("GET",this.url,!0),b.responseType="arraybuffer",b.onload=d(this,this._onSoundLoaded),b.onerror=d(this,this._error),b.send(),null!=a&&(this._options.onload=a)}return this},play:function(a,b){var c=this;if(!this._isLoaded)return this;if(this._muted)return this;var d=0,e=-1;this.isSpriteSound&&null!=b&&(d=b.start,e=b.duration);var f=this._manager.bufferList.get(this.url);return null!=f&&(this._snd=this._makeSource(f),d>=0&&e>-1?this._snd.start(0,d,e):(this._snd.loop=this._options.loop,this._snd.start(0)),this._isPlaying=!0,this._snd.onended=function(){c.isSpriteSound&&null!=b&&b.loop&&d>=0&&e>-1&&c.play(a,b),c._isPlaying=!1,null!=c._options.onend&&c._options.onend(c)},null==this._manager.playingSounds.get(this.url)&&this._manager.playingSounds.set(this.url,this._snd)),this},isPlaying:function(){return this._isPlaying},loop:function(a){null!=this._snd&&this._isLoaded&&(this._snd.loop=a)},setVolume:function(a){null!=this._gainNode&&this._isLoaded&&(this._options.volume=a,this._gainNode.gain.value=this._options.volume)},getVolume:function(){return this._options.volume},mute:function(a){this._muted=a,null!=this._gainNode&&this._isLoaded&&(a?this._gainNode.gain.value=0:this._gainNode.gain.value=this._options.volume)},stop:function(){null!=this._snd&&this._isLoaded&&this._snd.stop(0)},onEnd:function(a){return this._options.onend=a,this},onLoad:function(a){return this._options.onload=a,this},destroy:function(){null!=this._snd&&(this._snd.stop(0),this._snd.disconnect(),this._snd=null),null!=this._gainNode&&(this._gainNode.disconnect(),this._gainNode=null)}});var s=function(){},t=function(a){var b=this;this.id=setInterval(function(){b.run()},a)};t.delay=function(a,b){var c=new t(b);return c.run=function(){c.stop(),a()},c},t.prototype={stop:function(){null!=this.id&&(clearInterval(this.id),this.id=null)},run:function(){}};var u=function(a,b){this.map=a,this.keys=b,this.index=0,this.count=b.length};u.prototype={hasNext:function(){return this.index<this.count},next:function(){return this.map.get(this.keys[this.index++])}};var v=function(){this.h={}};v.__interfaces__=[s],v.prototype={set:function(a,b){null!=z[a]?this.setReserved(a,b):this.h[a]=b},get:function(a){return null!=z[a]?this.getReserved(a):this.h[a]},setReserved:function(a,b){null==this.rh&&(this.rh={}),this.rh["$"+a]=b},getReserved:function(a){return null==this.rh?null:this.rh["$"+a]},arrayKeys:function(){var a=[];for(var b in this.h)this.h.hasOwnProperty(b)&&a.push(b);if(null!=this.rh)for(var b in this.rh)36==b.charCodeAt(0)&&a.push(b.substr(1));return a},iterator:function(){return new u(this,this.arrayKeys())}};var w=function(a){Error.call(this),this.val=a,this.message=String(a),Error.captureStackTrace&&Error.captureStackTrace(this,w)};w.__super__=Error,w.prototype=c(Error.prototype,{});var x,y=0,z={};n.useWebAudio=!0,n.defaults={autoplay:!1,loop:!1,preload:!0,webaudio:!0,volume:1},n.preferredSampleRate=44100,n.isMuted=!1,o.FOCUS_STATE="focus",o.BLUR_STATE="blur",q.ua=window.navigator.userAgent}("undefined"!=typeof console?console:{log:function(){}},"undefined"!=typeof window?window:exports);